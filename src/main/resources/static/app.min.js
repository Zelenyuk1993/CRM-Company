var app=angular.module("ERP",["ngMaterial","ui.router","ngMdIcons"]);app.config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("app",{"abstract":!0,url:"",controller:"HeaderController",templateUrl:"template/header.html"}).state("app.main",{url:"/",controller:"TreeController",templateUrl:"template/tree.html"}).state("app.company",{url:"/show/{companyId}",controller:"CompanyController",templateUrl:"template/companyShow.html"}),e.state("error",{"abstract":!0,url:"/error",template:"<ui-view/>"}).state("error.404",{url:"^/404",templateUrl:"template/404.html"}),n.otherwise("/404")}]),app.controller("CompanyController",["$scope","$stateParams","serverService",function(e,n,o){function t(){o.getCompany(n.companyId).then(function(n){e.company=n,0!=e.company.childrenCompanies.length&&void 0==e.company.sum&&(e.company.sum=_.sumBy(e.company.childrenCompanies,function(e){return e.profit})+e.company.profit),e.newCompany={id:null,name:"",profit:0,parentCompanies:{id:e.company.id,name:e.company.name,profit:e.company.profit}}})}t(),e.updateCompany=function(e){o.updateCompany(e).then(function(){t()})},e.deleteCompany=function(e){o.deleteCompany(e).then(function(){t()})},e.save=function(){o.saveCompany(e.newCompany).then(function(){t()})},e.addFilial=function(){e.company.childrenCompanies.push(e.newCompany)}}]),app.controller("HeaderController",["$scope",function(e){}]),app.controller("TreeController",["$scope","serverService",function(e,n){var o=[];n.getCompanies().then(function(n){e.companies=n,_.filter(e.companies,function(n,t){void 0!=n.parentCompanies&&_.filter(e.companies,function(e){e.id==n.parentCompanies.id&&(void 0==e.childrenClient&&(e.childrenClient=[]),e.childrenClient.push(n),o.push(t))})});for(var t=o.length-1;t>=0;t--)e.companies.splice(o[t],1)})}]),app.factory("serverService",["$http","$q",function(e,n){var o={companiesGET:"/api/companies",companyGET:"/api/company",companyDELETE:"/api/company",companyPUT:"/api/company",companyPOST:"/api/company"};return{getCompanies:function(){var t=n.defer();return e.get(o.companiesGET).then(function(e){t.resolve(e.data)}),t.promise},saveCompany:function(t){var a=n.defer();return e.post(o.companyPOST,t).then(function(e){a.resolve(e.data)}),a.promise},getCompany:function(t){var a=n.defer();return e.get(o.companyGET+"/"+t).then(function(e){a.resolve(e.data)}),a.promise},deleteCompany:function(t){var a=n.defer();return e["delete"](o.companyDELETE+"/"+t).then(function(e){a.resolve(e.data)}),a.promise},updateCompany:function(t){var a=n.defer();return e.put(o.companyPUT,t).then(function(e){a.resolve(e.data)}),a.promise}}}]);